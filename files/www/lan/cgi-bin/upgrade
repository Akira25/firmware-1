#!/usr/bin/haserl --upload-dir=/tmp --upload-limit=12000
<%
echo -en "content-type: text/plain\r\n\r\n"

case "${GET_func:-$POST_func}" in
	apply_firmware)
		path="$POST_firmware"
		keep="$POST_keep_config"

		if [ ! -f "$path" ]; then
			echo "(E) Fehler: Datei nicht gefunden."
			exit 1
		fi

		if [ "$keep" = "yes" ]; then
			args=""
		else
			args="-n"
		fi

		echo "(I) Starte Update ..."

		#apply openwrt or vendor image
		sysupgrade $args $path
	;;
	lookup_upgrade)
		autoupdater -c 2>&1
	;;
	lookup_and_apply_upgrade)
		autoupdater -f 2>&1
	;;
	restore_firmware)
		echo "(I) Alle &#196;nderungen werden zur&#252;ckgesetzt ..."
		echo y | firstboot
		echo "(I) Starte neu ..."
		reboot
	;;
	*)
		echo "(E) Unbekannter Befehl: '$GET_func'"
	;;
esac
%>
